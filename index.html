<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Validador de CAF</title>
  <style>
  :root{ --green:#2e7d32; --green-700:#1b5e20; --muted:#f5f5f5; --ink:#111; --panel:#fff; }
  *{ box-sizing:border-box }
  body{ font-family: Arial, Helvetica, sans-serif; color:var(--ink); margin:0; background:#fff }
  .wrap{ max-width:980px; margin:auto; padding:40px 20px }
  h1{ color:var(--green); font-size:32px; margin:0 0 8px }
  .lead{ margin:0 0 18px; line-height:1.5 }
  code{ background:#eef7ee; padding:2px 6px; border-radius:6px }

  .toolbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin:16px 0 24px }
  .link-btn{ display:inline-flex; align-items:center; gap:8px; text-decoration:none; border:1px solid var(--green); color:var(--green); background:transparent; border-radius:999px; padding:8px 14px; font-weight:600 }
  .link-btn:hover{ background:var(--green); color:#fff }
  .link-btn svg{ width:18px; height:18px }

  .panel{ background:var(--panel); border:1px solid #e7e7e7; border-radius:14px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04) }
  .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap }
  input[type="text"]{ flex:1 1 420px; min-width:260px; padding:12px 16px; font-size:16px; border:2px solid var(--green); border-radius:999px; outline:none }
  input[type="text"]:focus{ border-color:var(--green-700) }
  button.primary{ padding:12px 18px; background:var(--green); color:#fff; border:none; border-radius:999px; cursor:pointer; font-weight:700 }
  .hint{ font-size:13px; color:#555; margin-top:8px }
  .stats{ display:flex; gap:12px; align-items:center; margin:14px 0 0; font-size:14px }
  .badge{ display:inline-block; background:#eef7ee; color:var(--green); border:1px solid var(--green); border-radius:999px; padding:4px 10px; font-weight:600 }
  .danger{ color:#b00020 } .ok{ color:var(--green) }

  /* SEMPRE 1 COLUNA */
  .result .grid{
    display:grid;
    grid-template-columns: 1fr; /* for√ßa lista √∫nica */
    gap:10px;
  }

  /* CADA LINHA: c√≥digo + a√ß√µes √† direita */
  .item{
    display:grid;
    grid-template-columns: 1fr auto; /* c√≥digo ocupa o espa√ßo, bot√µes √† direita */
    align-items:start;                /* alinha topo para quando o c√≥digo quebrar */
    gap:12px;
    background:var(--muted);
    padding:10px 12px;
    border-radius:10px;
  }

  /* MOSTRAR O C√ìDIGO COMPLETO (quebra de linha) */
  .code{
    font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    font-size:15px;
    white-space: normal;        /* permite quebrar linha */
    overflow: visible;          /* nada de scroll/corte */
    word-break: break-word;     /* quebra entre palavras se necess√°rio */
    overflow-wrap: anywhere;    /* quebra em qualquer ponto se for string cont√≠nua */
  }

  /* BOT√ïES com largura constante para n√£o "dan√ßar" */
  .actions{ display:flex; gap:8px; }
  .ghost{
    background:transparent; color:var(--green);
    border:1px solid var(--green); border-radius:999px;
    padding:6px 12px; cursor:pointer; font-weight:600;
    min-width:84px; display:inline-flex; align-items:center; justify-content:center;
  }
    
  .ghost:hover{ background:var(--green); color:#fff }
  /* espa√ßo extra no final da p√°gina */
.wrap{ padding-bottom: 90px; }

/* Bot√£o flutuante do WhatsApp */
.whatsapp-fab{
  position: fixed;
  right: 16px;
  bottom: 16px;
  z-index: 10000;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #25D366;
  color: #fff;
  text-decoration: none;
  border-radius: 999px;
  padding: 10px 14px;
  font-weight: 700;
  box-shadow: 0 6px 16px rgba(0,0,0,.18);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.whatsapp-fab:hover{
  filter: brightness(.95);
  transform: scale(1.05);
  box-shadow: 0 8px 20px rgba(0,0,0,.25);
}
.whatsapp-fab svg{ width: 18px; height: 18px; }

</style>

</head>
<a
  class="whatsapp-fab"
  href="https://wa.me/5575999778739?text=Ol%C3%A1%2C%20solicito%20orienta%C3%A7%C3%A3o%20sobre%20o%20Site%20Validador%20da%20CAF"
  target="_blank" rel="noopener" aria-label="Suporte no WhatsApp"
  title="Suporte no WhatsApp">
  <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
    <path d="M20.5 3.5A11 11 0 0 0 3.1 17.3L2 22l4.8-1.2A11 11 0 1 0 20.5 3.5Zm-8.6 16a9 9 0 0 1-4.6-1.3l-.3-.2-2.7.7.7-2.6-.2-.3a9 9 0 1 1 7.1 3.7Zm5-6.8c-.3-.2-1.7-.8-1.9-.9s-.4-.1-.6.1-.7.9-.9 1.1-.3.2-.6.1a7.3 7.3 0 0 1-3.3-2 7.1 7.1 0 0 1-1.4-2.5c-.1-.3 0-.4.1-.6l.5-.6c.1-.2.2-.4.3-.6a.6.6 0 0 0 0-.6c0-.2-.6-1.5-.8-2S7.8 4 7.5 4H7a1.2 1.2 0 0 0-.9.4 3.9 3.9 0 0 0-1.2 3c0 1.7 1.2 3.3 1.3 3.6a11.6 11.6 0 0 0 4.4 4.2c.5.2 2 .8 2.7 1s1.7.1 2.3-.1a3.3 3.3 0 0 0 2.2-1.6c.2-.4.2-1 .2-1s-.2-.2-.4-.3Z"/>
  </svg>
  Suporte no WhatsApp
</a>

<body>
  <div class="wrap">
    <h1>VALIDADOR DE CAF</h1>
    <p class="lead">
      Digite o CAF com curingas (<code>*</code>) para gerar combina√ß√µes no servidor. Exemplo:
      <code>BA032025.01.00**39367CAF</code>
    </p>

    <div class="toolbar">
      <a class="link-btn" href="https://www.youtube.com/watch?v=XXXXXXXXXXX" target="_blank" rel="noopener">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
        V√≠deo de Instru√ß√µes
      </a>
      <a class="link-btn" href="https://caf.mda.gov.br/consulta-publica/ufpa" target="_blank" rel="noopener">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M3.9 12a5 5 0 0 1 5-5h3v2h-3a3 3 0 0 0 0 6h3v2h-3a5 5 0 0 1-5-5Zm7-1h2v2h-2v-2Zm3.1-4h3a5 5 0 0 1 0 10h-3v-2h3a3 3 0 0 0 0-6h-3V7Z"/></svg>
        Site oficial de consulta do CAF
      </a>
    </div>

    <div class="panel">
      <div class="row">
        <input id="inputCAF" type="text" placeholder="Ex.: BA032025.01.00**39367CAF" />
        <button id="btnGerar" class="primary">GERAR CAF</button>
      </div>
      <div class="hint">
        ‚Ä¢ Aceita letras mai√∫sculas, n√∫meros, ponto e asterisco. O backend cruza m√™s/ano com a planilha.
      </div>
      <div class="stats" id="stats"></div>
    </div>

    <div class="result" id="resultado"></div>

    <p class="footer-note">
      Clique na <b>lupa</b> para abrir a consulta com o CAF copiado. <b>Copiar</b> coloca o c√≥digo na √°rea de transfer√™ncia.
    </p>
  </div>

  <script>
    const input = document.getElementById('inputCAF');
    const btn = document.getElementById('btnGerar');
    const out = document.getElementById('resultado');
    const stats = document.getElementById('stats');

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      Object.assign(t.style,{position:'fixed',right:'16px',bottom:'16px',background:'#333',color:'#fff',
        padding:'8px 12px',borderRadius:'10px',fontSize:'13px',opacity:'0',transition:'opacity .2s',zIndex:9999});
      document.body.appendChild(t); requestAnimationFrame(()=>t.style.opacity='1');
      setTimeout(()=>{t.style.opacity='0'; setTimeout(()=>t.remove(),200)},1200);
    }

    function linhaCAF(code){
      const div = document.createElement('div'); div.className = 'item';
      const left = document.createElement('div'); left.className = 'code'; left.textContent = code;
      const actions = document.createElement('div'); actions.className = 'actions';
      const btnCopy = document.createElement('button'); btnCopy.className='ghost'; btnCopy.textContent='Copiar';
      btnCopy.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(code); toast('Copiado!'); }catch{} });
      const btnLupa = document.createElement('button'); btnLupa.className='ghost'; btnLupa.innerHTML='üîç'; btnLupa.title='Abrir consulta do CAF';
      btnLupa.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(code);}catch{} window.open('https://caf.mda.gov.br/consulta-publica/ufpa?caf='+encodeURIComponent(code),'_blank','noopener'); });
      actions.append(btnCopy, btnLupa); div.append(left, actions); return div;
    }

    async function gerar(){
      out.innerHTML = ''; stats.textContent = 'Processando...';
      const caf = (input.value || '').trim().toUpperCase();
      try{
        const resp = await fetch('/api/gerar', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ caf }) });
        const data = await resp.json();
        if(!resp.ok){ stats.innerHTML = `<span class="badge danger">Erro</span> <span>${data.erro||'Falha ao gerar.'}</span>`; return; }
        stats.innerHTML = `<span class="badge ok">OK</span> <span>Geradas <b>${data.combos.length.toLocaleString()}</b> combina√ß√µes.</span>`;
        const grid = document.createElement('div'); grid.className='grid';
        for(const code of data.combos) grid.appendChild(linhaCAF(code));
        out.appendChild(grid);
      }catch(err){ stats.innerHTML = `<span class="badge danger">Erro</span> <span>${err.message}</span>`; }
    }

    btn.addEventListener('click', gerar);
    input.addEventListener('keydown', e => { if(e.key==='Enter') gerar(); });
  </script>
</body>
</html>
